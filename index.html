<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DAAW Cover Sheet Generator</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --muted:#9fb0ffcc;
      --text:#eaf0ff;
      --line:#2a3570;
      --accent:#7aa2ff;
      --accent2:#a7ffda;
      --danger:#ff7a7a;
      --radius:16px;
      --shadow:0 14px 40px rgba(0,0,0,.35);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 800px at 20% 0%, #1a2a6a55, transparent 55%),
                  radial-gradient(900px 700px at 90% 10%, #0fe2a855, transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:24px;
    }

    .wrap{ width:min(980px, 100%); }

    header{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      margin-bottom:18px;
    }

    h1{
      margin:0;
      font-size: clamp(22px, 2.6vw, 34px);
      letter-spacing:.2px;
    }
    .sub{
      margin:6px 0 0 0;
      color:var(--muted);
      max-width:70ch;
      line-height:1.35;
      font-size: 14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    @media (max-width: 860px){
      .grid{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, #141d3c, #0f1530);
      border:1px solid #22306a;
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
    }

    .section-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:12px;
    }
    .section-title h2{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
    }
    .pill{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      border:1px solid #2a3570;
      padding:6px 10px;
      border-radius:999px;
      background:#0b102055;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-bottom:12px;
    }
    @media (max-width: 520px){
      .row{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px 2px;
    }
    input, select{
      width:100%;
      box-sizing:border-box;
      border-radius:12px;
      border:1px solid #2a3570;
      background:#0b1020cc;
      color:var(--text);
      padding:10px 12px;
      outline:none;
      font-size:14px;
    }
    input:focus, select:focus{
      border-color: var(--accent);
      box-shadow: 0 0 0 3px #7aa2ff2b;
    }

    .checks{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:6px;
    }
    .check{
      display:flex;
      align-items:flex-start;
      gap:10px;
      padding:10px 10px;
      border:1px solid #22306a;
      border-radius:12px;
      background:#0b102055;
    }
    .check input[type="checkbox"]{
      width:18px;
      height:18px;
      margin-top:2px;
      accent-color: var(--accent2);
    }
    .check .txt{
      line-height:1.25;
      font-size:13px;
      color:var(--text);
    }
    .check .mut{
      display:block;
      color:var(--muted);
      font-size:12px;
      margin-top:4px;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:14px;
    }
    button{
      border:0;
      cursor:pointer;
      border-radius:14px;
      padding:10px 14px;
      font-weight:700;
      color:#081028;
      background: linear-gradient(90deg, var(--accent), #8cc8ff);
    }
    button.secondary{
      background: transparent;
      color: var(--text);
      border:1px solid #2a3570;
    }
    button:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    .note{
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
      margin-top:12px;
    }
    .err{
      margin-top:10px;
      color: var(--danger);
      font-size:13px;
      display:none;
      white-space:pre-wrap;
    }

    .preview{
      font-family: var(--mono);
      font-size: 12px;
      color: #dfe7ffcc;
      background:#070a14;
      border:1px solid #22306a;
      border-radius:12px;
      padding:12px;
      overflow:auto;
      max-height: 420px;
      line-height:1.35;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>DAAW Cover Sheet Generator</h1>
        <p class="sub">
          Fill it out → download a Word doc you can sign. Your data stays in your browser.
        </p>
      </div>
      <div class="pill" id="todayPill">Loading date…</div>
    </header>

    <div class="grid">
      <div class="card">
        <div class="section-title">
          <h2>Fill-in Fields</h2>
          <span class="pill">Outputs: .docx</span>
        </div>

        <div class="row">
          <div>
            <label for="assignment_name">Assignment title</label>
            <input id="assignment_name" placeholder="e.g., Lesson 3 Reflection" />
          </div>
          <div>
            <label for="class_name">Class</label>
            <input id="class_name" placeholder="e.g., PL150 Psychology & Leadership" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="section">Section</label>
            <input id="section" placeholder="e.g., H2" />
          </div>
          <div>
            <label for="company">Company</label>
            <input id="company" placeholder="e.g., D4" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="cadet_first">Cadet first</label>
            <input id="cadet_first" placeholder="First" />
          </div>
          <div>
            <label for="cadet_last">Cadet last</label>
            <input id="cadet_last" placeholder="Last" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="class_year">Class year (2-digit)</label>
            <input id="class_year" placeholder="29" inputmode="numeric" />
          </div>
          <div>
            <label for="initials">Initials (for checkbox lines)</label>
            <input id="initials" placeholder="e.g., JTD" />
          </div>
        </div>

        <div class="section-title" style="margin-top:14px;">
          <h2>Instructor</h2>
        </div>

        <div class="row">
          <div>
            <label for="instructor_rank">Rank</label>
            <input id="instructor_rank" placeholder="e.g., CPT" />
          </div>
          <div>
            <label for="instructor_first">First</label>
            <input id="instructor_first" placeholder="First" />
          </div>
        </div>

        <div class="row">
          <div>
            <label for="instructor_last">Last</label>
            <input id="instructor_last" placeholder="Last" />
          </div>
          <div>
            <label for="date_format">Date format</label>
            <select id="date_format">
              <option value="DD_M_YYYY">DD M YYYY (11 Jan 2026)</option>
              <option value="DD_MMM_YYYY">DD MMM YYYY (11 JAN 2026)</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button id="btnGenerate">Generate .docx</button>
          <button class="secondary" id="btnFillDemo" type="button">Fill demo data</button>
          <button class="secondary" id="btnClear" type="button">Clear</button>
        </div>

        <div class="err" id="errBox"></div>

        <p class="note">
          Requires a <span style="font-family:var(--mono)">template.docx</span> in the same folder that contains placeholders like
          <span style="font-family:var(--mono)">{{assignment_name}}</span>.
        </p>
      </div>

      <div class="card">
        <div class="section-title">
          <h2>Initial which lines?</h2>
          <span class="pill">Choose boxes → inserts initials</span>
        </div>

        <div class="checks">
          <div class="check">
            <input type="checkbox" id="chk_sources" />
            <div class="txt">
              “I certify I have completely documented all sources…”
              <span class="mut">Puts your initials in the blank before this statement.</span>
            </div>
          </div>

          <div class="check">
            <input type="checkbox" id="chk_no_sources" />
            <div class="txt">
              “I certify I did not use any sources or receive any assistance requiring documentation…”
              <span class="mut">Puts your initials in the blank before this statement.</span>
            </div>
          </div>

          <div class="check">
            <input type="checkbox" id="chk_ai_used" />
            <div class="txt">
              “I acknowledge that I used generative AI…”
              <span class="mut">Puts your initials in the blank before this statement.</span>
            </div>
          </div>

          <div class="check">
            <input type="checkbox" id="chk_ai_not_used" />
            <div class="txt">
              “I acknowledge that I did not use generative AI…”
              <span class="mut">Puts your initials in the blank before this statement.</span>
            </div>
          </div>
        </div>

        <div class="section-title" style="margin-top:14px;">
          <h2>What gets sent into the template</h2>
          <span class="pill">preview</span>
        </div>
        <div class="preview" id="previewBox"></div>

        <p class="note">
          Signature line stays blank so you can sign by hand. You can also leave the signature date blank if you want.
        </p>
      </div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.6/dist/pizzip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/docxtemplater@3.49.0/build/docxtemplater.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pizzip@3.1.6/dist/pizzip-utils.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script>
    const $ = (id) => document.getElementById(id);

    function pad2(n){ return String(n).padStart(2,'0'); }

    function formatDate(mode){
      const d = new Date();
      const day = pad2(d.getDate());
      const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      const m = months[d.getMonth()];
      const y = d.getFullYear();

      if (mode === "DD_MMM_YYYY") {
        return `${day} ${m.toUpperCase()} ${y}`;
      }
      // default: 11 Jan 2026 style
      return `${day} ${m} ${y}`;
    }

    function showError(msg){
      const box = $("errBox");
      box.style.display = msg ? "block" : "none";
      box.textContent = msg || "";
    }

    function getFormData(){
      const initials = $("initials").value.trim();
      const wantInit = (checked) => checked ? (initials || "____") : "____";

      const data = {
        assignment_name: $("assignment_name").value.trim(),
        class_name: $("class_name").value.trim(),
        section: $("section").value.trim(),
        instructor_rank: $("instructor_rank").value.trim(),
        instructor_first: $("instructor_first").value.trim(),
        instructor_last: $("instructor_last").value.trim(),
        cadet_first: $("cadet_first").value.trim(),
        cadet_last: $("cadet_last").value.trim(),
        class_year: $("class_year").value.trim(),
        company: $("company").value.trim(),

        // date fields for the docx
        date_long: formatDate($("date_format").value),
        signature_date: formatDate($("date_format").value), // change to "" if you want blank

        // initials blanks for each line
        init_sources: wantInit($("chk_sources").checked),
        init_no_sources: wantInit($("chk_no_sources").checked),
        init_ai_used: wantInit($("chk_ai_used").checked),
        init_ai_not_used: wantInit($("chk_ai_not_used").checked),
      };
      return data;
    }

    function updatePreview(){
      const data = getFormData();
      $("previewBox").textContent = JSON.stringify(data, null, 2);
    }

    // Keep preview live
    document.addEventListener("input", (e) => {
      if (e.target && e.target.matches("input,select")) updatePreview();
    });

    function requiredFieldsMissing(data){
      const req = ["assignment_name","class_name","section","cadet_first","cadet_last","company","class_year"];
      const missing = req.filter(k => !data[k]);
      return missing;
    }

    async function loadBinary(url){
      return new Promise((resolve, reject) => {
        window.PizZipUtils.getBinaryContent(url, (err, data) => {
          if (err) reject(err);
          else resolve(data);
        });
      });
    }

    async function generateDocx(){
      showError("");
      const data = getFormData();

      const missing = requiredFieldsMissing(data);
      if (missing.length){
        showError("Missing required fields: " + missing.join(", "));
        return;
      }

      try{
        const content = await loadBinary("template.docx");
        const zip = new PizZip(content);
        const doc = new window.docxtemplater(zip, {
			paragraphLoop: true,
			linebreaks: true,
			delimiters: { start: "{{", end: "}}" }
		});


        doc.setData(data);

        try{
          doc.render();
        } catch (error){
          console.error(error);
          showError(
            "Template render error.\n\n" +
            "Most common causes:\n" +
            "• Your template.docx does not include the placeholders used by this site.\n" +
            "• A placeholder got split across Word runs (retype it cleanly).\n\n" +
            "Details:\n" + (error.message || String(error))
          );
          return;
        }

        const out = doc.getZip().generate({
          type: "blob",
          mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
        });

        const filenameSafe = `${data.cadet_last || "Cadet"}_${data.assignment_name || "DAAW"}_coversheet.docx`
          .replace(/[\\/:*?"<>|]+/g,"-")
          .slice(0, 120);

        saveAs(out, filenameSafe);
      } catch (e){
        console.error(e);
        showError(
          "Could not load template.docx.\n\n" +
          "Make sure:\n" +
          "• template.docx is in the SAME folder as index.html\n" +
          "• you opened index.html in a browser that allows local file access\n\n" +
          "Error: " + (e.message || String(e))
        );
      }
    }

    function fillDemo(){
  $("assignment_name").value = "Lesson Reflection";
  $("class_name").value = "PL150 Psychology & Leadership";
  $("section").value = "H2";
  $("company").value = "D4";

  // Demo cadet info (NO Jet references)
  $("cadet_first").value = "John";
  $("cadet_last").value = "Doe";
  $("class_year").value = "29";
  $("initials").value = "JTD";

  // Demo instructor info
  $("instructor_rank").value = "CPT";
  $("instructor_first").value = "John";
  $("instructor_last").value = "Thayer";

  // Demo checkbox selections
  $("chk_sources").checked = true;
  $("chk_no_sources").checked = false;
  $("chk_ai_used").checked = false;
  $("chk_ai_not_used").checked = true;

  updatePreview();
}


    function clearAll(){
      document.querySelectorAll("input").forEach(i => {
        if (i.type === "checkbox") i.checked = false;
        else i.value = "";
      });
      $("date_format").value = "DD_M_YYYY";
      showError("");
      updatePreview();
    }

    // wire up
    $("btnGenerate").addEventListener("click", generateDocx);
    $("btnFillDemo").addEventListener("click", fillDemo);
    $("btnClear").addEventListener("click", clearAll);

    // init
    $("todayPill").textContent = "Today: " + formatDate("DD_M_YYYY");
    updatePreview();
  </script>
</body>
</html>
